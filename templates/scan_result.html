{% extends "base.html" %}
{% block content %}
<h2>Scan Results for {{ scan.targets | join(', ') }}</h2>
<p><strong>Status:</strong> {{ scan.status }}</p>
<p><strong>Started At:</strong> {{ scan.started_at }}</p>
<p><strong>Completed At:</strong> {{ scan.completed_at }}</p>

<h3>Findings</h3>
<table class="table-auto border-collapse border border-gray-300 w-full">
    <thead class="bg-gray-100">
        <tr>
            <th class="border px-4 py-2">IP Address</th>
            <th class="border px-4 py-2">Hostname</th>
            <th class="border px-4 py-2">Open Ports</th>
            <th class="border px-4 py-2">Vulnerabilities</th>
        </tr>
    </thead>
    <tbody>
        {% if scan.raw_data %}
        {% for finding in scan.raw_data %}
        <tr>
            <td class="border px-4 py-2">{{ finding.ip }}</td>
            <td class="border px-4 py-2">{{ finding.hostname }}</td>
            <td class="border px-4 py-2">
                {% if finding.open_ports %}
                    <ul>
                        {% for port in finding.open_ports %}
                            <li>{{ port.port }}/{{ port.protocol }} - {{ port.service }}</li>
                        {% endfor %}
                    </ul>
                {% else %}
                    No open ports
                {% endif %}
            </td>
            <td class="border px-4 py-2">
                {% if finding.vulnerabilities %}
                    <ul>
                        {% for vuln in finding.vulnerabilities %}
                            <li>{{ vuln.id }}: {{ vuln.description }}</li>
                        {% endfor %}
                    </ul>
                {% else %}
                    No vulnerabilities
                {% endif %}
            </td>
        </tr>
        {% endfor %}
        {% endif %}
    </tbody>
</table>

<p><a href="/scan/{{ scan_id }}/pdf">Download PDF Report</a></p>
<p><a href="/">Back to Scan History</a></p>
{% endblock %}
